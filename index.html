<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Checklist R√©glementaire DM IA</title>
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin:0; padding: 0;
      background-image: url('image.jpg.jpeg'); 
      background-size: cover;
      background-position: top 80px center;
      background-repeat: no-repeat;
      min-height: 100vh;
    }
    header { 
      background: #82b8ea;
      color: #0a0a0a; 
      padding: 10px 10px; 
      display: flex; 
      align-items: flex-end; 
      justify-content: space-between;
      flex-wrap: wrap;
    }
    .header-titles { flex: 1 1 350px; min-width: 250px; }
    .header-photos { display: flex; gap: 10px; align-items: flex-end; }
    .photo-group { display: flex; flex-direction: column; align-items: center; }
    .photo-group img {
      width: 52px; height: 52px; object-fit: cover;
      border-radius: 50%; border:2px solid #fff;
      background: #fafafa; margin-bottom: 2px;
    }
    .photo-name { font-size: 0.96em; font-weight: bold; line-height: 1; text-align: center; }
    .photo-prenom { font-size: 0.87em; text-align: center; color: #e7b3b3; }
    h1 { margin:0 0 8px 0; font-size: 1.23em; text-align:center; }
    #connexion { max-width: 900px; margin-left: 100px; }
    .container {
      max-width: 1200px;
      margin: 30px auto;
      background: rgba(255,255,255,0.93);
      padding: 30px;
      border-radius:10px;
      box-shadow: 0 6px 24px rgba(0,0,0,0.18);
    }
    .hide { display: none }
    input[type="text"], select { width: 95%; padding: 7px; margin: 8px 0 16px 0; border-radius: 4px; border:1px solid #ccc;}
    button { background:#04284b; color: #fff; border:none; padding:10px 17px; border-radius:5px; font-weight:bold; cursor:pointer;}
    button:hover { background: #00b315 }
    table { border-collapse: collapse; width: 100%; margin: 6px 0;}
    th, td { border:1px solid #ddd; padding:8px; text-align:left; vertical-align:top;}
    td:nth-child(2) { font-size: 0.85em; font-weight: 600;text-align: justify;}
    td:nth-child(3) span { font-size: 0.75em !important; }
    td:nth-child(5) { font-size: 0.85em; }
    td:nth-child(6) { font-size: 0.85em; }
    th { background: #eef; }
    nav { margin-bottom: 18px; }
    .tab-btn { background: #e9e9e9; color: #81b5e9; margin-right:5px; border:none; border-radius:5px 5px 0 0; padding:7px 13px;}
    .tab-btn.selected, .tab-btn:hover { background: #89b9ea; color:#fff;}
    .faq-question {font-weight:bold; margin-top:1em;}
    .small { font-size:0.92em; color:#b0b5ee;}
    .section-row td {
      background:#dfeeff;
      font-weight:bold;
      text-align:center;
    }
    #checkTable td:nth-child(3) {
      width: 22% !important;
      min-width: 180px;
    }
    #checkTable td:nth-child(3) div:first-child {
      text-align: justify;
      text-justify: inter-word;
    }
    #checkTable td:nth-child(3) span {
      text-align: justify;
      display: block;
    }
    .pdf-btn-container {
      text-align: right;
      margin-bottom: 6px;
    }
    .pdf-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: linear-gradient(135deg, #c84b3e 0%, #a0362e 100%);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 0.95em;
      box-shadow: 0 4px 12px rgba(200, 75, 62, 0.3);
      transition: all 0.3s ease;
    }
    .pdf-btn:hover {
      background: linear-gradient(135deg, #a0362e 0%, #802821 100%);
      box-shadow: 0 6px 16px rgba(200, 75, 62, 0.4);
      transform: translateY(-2px);
    }
    .pdf-btn:active {
      transform: translateY(0);
    }
    .pdf-icon {
      width: 18px;
      height: 18px;
    }
    #classification label { display:block; max-width:500px; }
    #classification select { width: 200px; }
  </style>
</head>
<body>

<img 
  src="frequently-asked√®question.avif" 
  alt="FAQ" 
  title="Voir la FAQ"
  onclick="showTab('faq')" 
  style="position:fixed; bottom:20px; right:20px; width:44px; height:44px; z-index:1001; cursor:pointer; box-shadow:0 2px 8px rgba(0,0,0,0.10); border-radius:8px;">

<header>
  <div class="header-titles">
    <h1>Checklist R√©glementaire pour la Validation de l'Aptitude √† l'Utilisation des Dispositifs M√©dicaux Int√©grant l'IA</h1>
    <div style="text-align:center;">Projet universitaire ‚Äì IDS 299 (UTC)</div>
  </div>
  <div class="header-photos">
    <div class="photo-group">
      <img src="maria.jpg" alt="Maria">
      <span class="photo-name">GAMBIE</span>
      <span class="photo-prenom">Maria</span>
    </div>
    <div class="photo-group">
      <img src="pauline.jpg" alt="Pauline">
      <span class="photo-name">GRESSENT</span>
      <span class="photo-prenom">Pauline</span>
    </div>
    <div class="photo-group">
      <img src="med.jpg" alt="Mohammed">
      <span class="photo-name">NAJI</span>
      <span class="photo-prenom">Mohammed</span>
    </div>
    <div class="photo-group">
      <img src="lyam.jpg" alt="Lyam">
      <span class="photo-name">PATTE</span>
      <span class="photo-prenom">Lyam</span>
    </div>
    <div class="photo-group">
      <img src="me (2).jpg" alt="Fatima-Zahra">
      <span class="photo-name">ZIMAR</span>
      <span class="photo-prenom">Fatima-Zahra</span>
    </div>
  </div>
</header>

<div class="container">
  <div id="connexion">
    <h2>Connexion</h2>
    <label>Nom : <input type="text" id="nom"></label><br>
    <label>Pr√©nom : <input type="text" id="prenom"></label><br>
    <label>Soci√©t√© : <input type="text" id="societe"></label><br>
    <label>Profession :
      <select id="profession">
        <option value="">Choisir</option>
        <option>QARA</option>
        <option>D√©veloppeur</option>
        <option>Concepteur</option>
        <option>Etudiant OU Professeur</option>
        <option>Autre</option>
      </select>
    </label><br>
    <button onclick="startApp()">Entrer</button>
  </div>

  <div id="app" class="hide">
    <nav>
      <button class="tab-btn" onclick="showTab('guide')">Guide</button>
      <button class="tab-btn selected" onclick="showTab('checklist')">Checklist</button>
    </nav>

    <div id="classification" class="hide">
      <h3>Param√®tres de classification du DM</h3>
      <label>Classe MDR :
        <select id="classeMdr">
          <option value="1">Classe I</option>
          <option value="1.5">Classe IIa</option>
          <option value="2">Classe IIb</option>
          <option value="3">Classe III</option>
        </select>
      </label>
      <label>IA composante de s√©curit√© :
        <select id="iaSecu">
          <option value="1">Non</option>
          <option value="2">Oui</option>
        </select>
      </label>
      <label>R√¥le autonome :
        <select id="roleAuto">
          <option value="1">Non</option>
          <option value="1.5">Oui</option>
        </select>
      </label>
      <button onclick="applyClassification()">Appliquer la classification</button>
      <span id="coefGlobalDisplay" style="margin-left:10px; font-weight:bold;"></span>
    </div>

<div id="guide" class="hide">
  <h2>Guide d'utilisation ‚Äì Checklist R√©glementaire</h2>
  
  <h3>1. Introduction</h3>
  <p>Ce guide vous explique comment utiliser efficacement la Checklist R√©glementaire pour la conception de logiciels dispositifs m√©dicaux int√©grant l'intelligence artificielle.</p>
  
  <h4>Objectif</h4>
  <ul>
    <li>Accompagner la phase de conception pour anticiper les exigences r√©glementaires</li>
    <li>√âviter les erreurs en amont de la certification</li>
    <li>Structurer la d√©marche qualit√© et r√©glementaire de mani√®re progressive</li>
  </ul>

  <h4>√Ä qui s'adresse cet outil ?</h4>
  <p>Aux startups en phase de R&D/prototypage qui d√©veloppent un logiciel dispositif m√©dical (SaMD) int√©grant de l'IA et qui souhaitent d√©marrer leur conformit√© r√©glementaire sans expertise pr√©alable.</p>

  <h3>2. Fonctionnement de la checklist</h3>
  <table style="margin: 20px 0;">
    <thead>
      <tr><th>Colonne</th><th>Description</th><th>Comment l'utiliser</th></tr>
    </thead>
    <tbody>
      <tr><td>Bloc de classification</td><td>Classe MDR, IA s√©curit√©, R√¥le autonome</td><td>Remplir selon caract√©ristiques du dispositif</td></tr>
      <tr><td>N¬∞</td><td>Num√©ro unique</td><td>R√©f√©rencer facilement les exigences</td></tr>
      <tr><td>Exigence / action</td><td>Ce qui doit √™tre r√©alis√©</td><td>Formuler comme une action concr√®te et mesurable</td></tr>
      <tr><td>Crit√®res de pond√©ration</td><td>4 crit√®res pour √©valuer l'exigence</td><td>D√©finir la criticit√© dans le p√©rim√®tre du projet</td></tr>
      <tr><td>Score</td><td>Crit√®res √ó coefficient global</td><td>Calcul automatique - d√©termine l'importance</td></tr>
      <tr><td>Objectif</td><td>Ce qui est essentiel √† retenir</td><td>Formuler plus simplement l'exigence</td></tr>
      <tr><td>R√©f√©rence</td><td>Norme ou article</td><td>Indication sur le r√©f√©rentiel utilis√©</td></tr>
      <tr><td>Preuve Attendue</td><td>Forme du justificatif de conformit√©</td><td>Donner une indication sur la forme des preuves</td></tr>
      <tr><td>Statut</td><td>√âtat d'avancement</td><td>√Ä faire / En cours / Termin√©</td></tr>
      <tr><td>Responsable</td><td>Qui pilote cette exigence ?</td><td>Nom ou r√¥le (ex: Responsable Qualit√©)</td></tr>
      <tr><td>Preuve tra√ßable</td><td>Justificatif de conformit√©</td><td>Lien vers rapport, fichier, ou r√©f√©rence</td></tr>
    </tbody>
  </table>

<h4>Bloc d'acceptabilit√© du risque</h4>
<table style="width:100%; margin:20px 0; border-collapse:collapse; font-size:0.95em;">
  <thead>
    <tr style="background:#eef;">
      <th style="padding:12px 8px; border:1px solid #ddd; width:25%;">Niveau</th>
      <th style="padding:12px 8px; border:1px solid #ddd;">Score</th>
      <th style="padding:12px 8px; border:1px solid #ddd;">Priorit√©</th>
    </tr>
  </thead>
  <tbody>
    <tr style="background:#d4edda; color:#155724;">
      <td style="padding:12px 8px; border:1px solid #ddd; font-weight:bold;">üü¢ FAIBLE</td>
      <td style="padding:12px 8px; border:1px solid #ddd; text-align:center; font-weight:bold;">1-7</td>
      <td style="padding:12px 8px; border:1px solid #ddd;">Exigence optionnelle ou all√©g√©e</td>
    </tr>
    <tr style="background:#fff3cd; color:#856404;">
      <td style="padding:12px 8px; border:1px solid #ddd; font-weight:bold;">üü° MOD√âR√âE</td>
      <td style="padding:12px 8px; border:1px solid #ddd; text-align:center; font-weight:bold;">7-14</td>
      <td style="padding:12px 8px; border:1px solid #ddd;">Exigence standard</td>
    </tr>
    <tr style="background:#f8d7da; color:#721c24;">
      <td style="padding:12px 8px; border:1px solid #ddd; font-weight:bold;">üî¥ CRITIQUE</td>
      <td style="padding:12px 8px; border:1px solid #ddd; text-align:center; font-weight:bold;">14+</td>
      <td style="padding:12px 8px; border:1px solid #ddd;">Exigence prioritaire</td>
    </tr>
  </tbody>
</table>

  <h3>3. Mode d'emploi pas √† pas</h3>
  <ol>
    <li><strong>√âtape 1 :</strong> Remplir le Bloc de classification selon votre dispositif</li>
    <li><strong>√âtape 2 :</strong> Pour chaque exigence : lire ‚Üí assigner responsable ‚Üí Mettez √† jour le statut au fur et √† mesure ‚Üí Joignez la preuve (lien vers document, rapport‚Ä¶)</li>
    <li><strong>√âtape 3 :</strong> Suivre les codes couleurs (vert/orange/rouge)</li>
    <li><strong>√âtape 4 :</strong> V√©rifier avant audit : tous statuts √† jour + preuves document√©es</li>
  </ol>

  <h3>4. Conseils d'utilisation</h3>
  <h4> üü¢ Bonnes pratiques</h4>
  <ul>
    <li>Ne sautez pas d'√©tapes : chaque exigence compte</li>
    <li>Documentez au fil de l'eau</li>
    <li>Impliquez toute l'√©quipe</li>
    <li>Consultez la FAQ en cas de doute</li>
  </ul>

  <h4>üî¥ Pi√®ges √† √©viter</h4>
  <ul>
    <li>Remplir "pour la forme" sans r√©aliser les actions</li>
    <li>N√©gliger les exigences IA</li>
    <li>Oublier de mettre √† jour les preuves</li>
  </ul>
</div>


    <div id="checklist">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2>Checklist interactive</h2>
        <div class="pdf-btn-container">
          <button class="pdf-btn" onclick="generatePDF()">
            <svg class="pdf-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><text x="8" y="16" font-size="8" font-weight="bold" fill="white">PDF</text>
            </svg>
            T√©l√©charger PDF
          </button>
        </div>
      </div>

      <table id="checkTable">
        <thead>
          <tr>
            <th>N¬∞</th>
            <th>Exigence / Action</th>
            <th>Crit√®re de pond√©ration des risques</th>
            <th>Score</th>
            <th>Objectif</th>
            <th>R√©f√©rence</th>
            <th>Statut</th>
            <th>Responsable</th>
            <th>Commentaires / Preuves (exemple de documents)</th>
          </tr>
        </thead>
        <tbody id="tbodyChecklist"></tbody>
      </table>
      <p class="small">
        Dans la colonne ‚ÄúCommentaires / Preuves‚Äù, les exemples indiquent les types de documents attendus
        (rapports, plans, dossiers) et peuvent guider o√π ranger vos fichiers sur votre propre syst√®me.
      </p>
    </div>

    <div id="faq" class="hide">
      <h2>FAQ principale</h2>

      <h3>Questions concernant la check-list</h3>

      <div class="faq-question">Q1 : √Ä quel moment dois-je commencer √† utiliser cette checklist ?</div>
      <div>
        D√®s que vous avez une id√©e de produit avec une destination m√©dicale revendiqu√©e.
        L'id√©al est de l'utiliser d√®s la phase de prototypage, avant m√™me d'√©crire la premi√®re ligne de code.
        Anticiper les exigences r√©glementaires d√®s la conception vous fera gagner du temps et de l'argent.
      </div>

      <div class="faq-question">Q2 : La checklist remplace-t-elle un consultant r√©glementaire ?</div>
      <div>
        Non. Cette checklist est un outil d'aide √† la structuration de votre d√©marche,
        mais elle ne remplace pas l'expertise d'un sp√©cialiste pour des cas complexes,
        des audits ou la pr√©paration finale du dossier technique.
      </div>

      <div class="faq-question">Q3 : Puis-je omettre certaines exigences si mon logiciel est "simple" ?</div>
      <div>
        Non. Toutes les exigences marqu√©es "Toutes classes" sont obligatoires.
        M√™me un logiciel de classe I doit respecter les exigences essentielles du MDR.
        Vous pouvez adapter le niveau de d√©tail selon la classe, mais pas ignorer les exigences.
      </div>

      <h3>Questions sur la classification et le p√©rim√®tre</h3>

      <div class="faq-question">Q4 : Comment savoir si mon logiciel est un dispositif m√©dical ?</div>
      <div>
        Votre logiciel est un DM s'il est destin√© par le fabricant √† √™tre utilis√© √† des fins m√©dicales :
        diagnostic, pr√©vention, surveillance, pr√©diction, pronostic ou traitement d'une maladie.
        Si vous revendiquez un b√©n√©fice clinique, c'est probablement un DM.
        Consultez la R√®gle 11 de l'Annexe VIII du MDR et le MDCG 2019-11 pour plus de d√©tails.
      </div>

      <div class="faq-question">Q5 : Mon logiciel utilise un simple algorithme de pr√©diction. Est-ce consid√©r√© comme de l'IA au sens de l'AI Act ?</div>
      <div>
        Oui, probablement. L'AI Act d√©finit l'IA de mani√®re large,
        incluant le machine learning et les approches statistiques.
        Si votre algorithme apprend √† partir de donn√©es ou utilise des techniques d'optimisation automatique,
        il entre dans le champ de l'AI Act.
      </div>

      <div class="faq-question">Q6 : Quelle est la diff√©rence entre classe IEC 62304 (A/B/C) et classe MDR (I/IIa/IIb/III) ?</div>
      <div>
        <strong>Classe MDR :</strong> classification r√©glementaire selon le risque pour le patient
        (d√©termine le parcours de certification).<br>
        <strong>Classe IEC 62304 :</strong> classification technique du logiciel selon l'impact d'une d√©faillance
        (d√©termine le niveau de rigueur du d√©veloppement).
      </div>
    </div>
  </div>
</div>

<script>
// -------- 1. Donn√©es de la checklist --------
const checklist = [
  { section: true, titre: "A ‚Äì D√âFINITION DU CONTEXTE D'UTILISATION" },
  { n:"A.1", act:"Former les √©quipes c≈ìur (conception, d√©veloppement, validation) aux sp√©cificit√©s des syst√®mes IA embarqu√©s dans les DM.", obj:"S'assurer de la comp√©tence des acteurs cl√©s pour identifier, √©valuer et ma√Ætriser les risques IA.", ref:"R√®glement (UE) 2024/1689 art.4", statut:"", resp:"", comm:"Matrice de comp√©tences et de responsabilit√©s, CV et dipl√¥mes", critChecks:[true,true,true,true] },
  { n:"A.2", act:"Pr√©parer la sp√©cification d'utilisation (indications, population cible, profil utilisateur, environnement, principe de fonctionnement, justification IA).", obj:"D√©finir le contexte m√©dical, utilisateur et le syst√®me IA d√®s le d√©but du projet.", ref:"IEC 62366-1 ¬ß5.1 ; IEC 22989 ¬ß6.2.2", statut:"", resp:"", comm:"Sp√©cifications d'utilisation et justification des choix", critChecks:[true,true,true,false] },
  { n:"A.3", act:"Adapter le contenu et la dur√©e de formation selon le contexte d'utilisation et les profils d'utilisateurs vis√©s.", obj:"Ajuster la formation en fonction des risques, de l'autonomie et des comp√©tences.", ref:"R√®glement (UE) 2024/1689 Art.4 ; ISO 62366-1 ¬ß5.3", statut:"", resp:"", comm:"Essais d'efficacit√© de formation", critChecks:[true,true,true,false] },
  { n:"A.4", act:"Prendre en compte le contexte d'utilisation dans la conception des jeux de donn√©es.", obj:"Aligner donn√©es d'entra√Ænement, de validation et de test sur le contexte clinique r√©el.", ref:"R√®glement (UE) 2024/1689 art.10 ¬ß4 ; ISO 62366-1 ¬ß5.3", statut:"", resp:"", comm:"Rapport comparatif des donn√©es d'entra√Ænement et des sp√©cifications", critChecks:[true,true,false,false] },
  { n:"A.5", act:"Prendre en compte les groupes vuln√©rables dans le design.", obj:"Adapter interfaces et messages pour les populations sensibles.", ref:"R√®glement (UE) 2024/1689 art.9 ¬ß9 & art.5(b)", statut:"", resp:"", comm:"Rapport d'√©tude de la performance du logiciel en conditions r√©elles", critChecks:[true,true,false,false] },
  { n:"A.6", act:"D√©crire les limites, les performances et les conditions d'emploi.", obj:"Permettre √† l'utilisateur d'√©valuer la fiabilit√© et les limites du syst√®me.", ref:"R√®glement (UE) 2024/1689 art.13 ¬ß3 b (ii-iii)", statut:"", resp:"", comm:"Plan et dossier de gestion de l'aptitude √† l'utilisation", critChecks:[true,true,false,false] },

  { section: true, titre: "B ‚Äì PILOTAGE DU PROCESSUS D'APTITUDE √Ä L'UTILISATION" },
  { n:"B.1", act:"√âtablir, documenter, mettre en ≈ìuvre et maintenir un processus d'ing√©nierie de l'aptitude √† l'utilisation (PIAU).", obj:"Assurer un pilotage clair du processus d'aptitude √† l'utilisation sur tout le cycle de vie.", ref:"IEC 62366-1 ¬ß4.1.1", statut:"", resp:"", comm:"Dossier d'analyse de risques", critChecks:[true,true,true,false] },
  { n:"B.2", act:"Adapter le niveau d'effort et les m√©thodes d'ing√©nierie selon la complexit√© de l'interface, la gravit√© des risques et les caract√©ristiques du dispositif.", obj:"Structurer et documenter l'ensemble des activit√©s li√©es √† l'aptitude √† l'utilisation.", ref:"IEC 62366-1 ¬ß5.1", statut:"", resp:"", comm:"Dossier d'aptitude √† l'utilisation", critChecks:[true,true,true,false] },
  { n:"B.3", act:"Consigner tous les r√©sultats du processus d'ing√©nierie dans le Dossier d'Ing√©nierie de l'Aptitude √† l'Utilisation (DIAU).", obj:"Garantir une vision partag√©e des exigences d'utilisation et des risques associ√©s.", ref:"IEC 62366-1 ¬ß4.1.2", statut:"", resp:"", comm:"Processus de supervision et de surveillance du logiciel", critChecks:[true,true,false,false] },
  { n:"B.4", act:"Documenter les mesures de supervision humaine", obj:"D√©tecter pr√©cocement les √©carts et adapter le processus si n√©cessaire.", ref:"IEC 62366-1 ¬ß5.8", statut:"", resp:"", comm:"Rapport d'analyse de risques r√©siduels", critChecks:[true,true,false,false] },

  { section: true, titre: "C ‚Äì MA√éTRISE DU RISQUE D'USAGE" },
  { n:"C.1", act:"Transparence et informations √† l'utilisateur (UI + IFU).", obj:"Permettre un usage avis√© et √©viter les interpr√©tations erron√©es.", ref:"R√®glement (UE) 2024/1689 art.13", statut:"", resp:"", comm:"Documents et informations d'accompagnement du logiciel", critChecks:[true,true,true,true] },
  { n:"C.2", act:"Appliquer la ma√Ætrise du risque pour la conception de l'interface utilisateur en respectant l'ordre de priorit√© : s√©curit√© inh√©rente, mesures de protection, informations de s√©curit√©.", obj:"R√©duire les risques d'erreurs d'utilisation et assurer la s√ªret√© de conception.", ref:"IEC 62366-1 ¬ß4.1.2", statut:"", resp:"", comm:"Analyse des risques et mesures de r√©duction des erreurs d'utilisation", critChecks:[true,true,true,true] },
  { n:"C.3", act:"Int√©grer les informations relatives √† la s√©curit√© dans le processus d'ing√©nierie pour s'assurer qu'elles sont perceptibles et compr√©hensibles par les utilisateurs.", obj:"Assurer la pertinence des informations de s√©curit√© fournies aux utilisateurs.", ref:"IEC 62366-1 ¬ß4.1.3", statut:"", resp:"", comm:"√âvaluation des documents et informations d'accompagnement", critChecks:[true,true,true,true] },
  { n:"C.4", act:"Mettre en place un plan d'√©valuations formatives (IEC 62366) ciblant l'IA.", obj:"D√©tecter pr√©cocement les erreurs d'utilisation li√©es √† l'IA.", ref:"R√®glement (UE) 2024/1689 art.13‚Äì14‚Äì15 (via IEC 62366)", statut:"", resp:"", comm:"Protocole d'√©valuation formative", critChecks:[true,true,true,true] },
  { n:"C.5", act:"Prendre en compte les groupes vuln√©rables dans l'analyse de risques.", obj:"Prot√©ger les groupes √† risque d'effets disproportionn√©s.", ref:"R√®glement (UE) 2024/1689 art. 9 ¬ß9", statut:"", resp:"", comm:"Int√©gration de repr√©sentants de groupes vuln√©rables dans l'√©valuation", critChecks:[true,true,true,false] },
  { n:"C.6", act:"Identifier et analyser les risques pr√©visibles li√©s √† l'usage et √† l'environnement.", obj:"Garantir la s√©curit√© d'usage et la robustesse fonctionnelle.", ref:"R√®glement (UE) 2024/1689 art. 9 ¬ß2(a-b) ; ISO 62366-1 ¬ß5.4", statut:"", resp:"", comm:"Analyse de risque sur l'utilisation du dispositif", critChecks:[true,true,false,false] },
  { n:"C.7", act:"D√©terminer et appliquer les mesures de ma√Ætrise adapt√©es.", obj:"Assurer un risque r√©siduel acceptable.", ref:"R√®glement (UE) 2024/1689 art. 9 ¬ß2(d)-¬ß5", statut:"", resp:"", comm:"Rapport de ma√Ætrise et d'att√©nuation des risques", critChecks:[true,true,true,true] },
  { n:"C.8", act:"Emp√™cher l'exploitation de vuln√©rabilit√©s individuelles.", obj:"Prot√©ger les utilisateurs vuln√©rables.", ref:"R√®glement (UE) 2024/1689 art. 5(1)(b)", statut:"", resp:"", comm:"Mesures d'accessibilit√© de l'interface (taille, couleur...)", critChecks:[true,true,true,false] },
  { n:"C.9", act:"Concevoir pour √©liminer ou r√©duire le risque √† la source.", obj:"R√©duire le risque par design (‚Äúsafety by design‚Äù).", ref:"R√®glement (UE) 2024/1689 art. 9 ¬ß5(a) ; IEC 62304 ¬ß5.2", statut:"", resp:"", comm:"Exigences UI issues de l'analyse de risque", critChecks:[true,true,true,true] },
  { n:"C.10", act:"Former et qualifier les utilisateurs et d√©ployeurs.", obj:"Garantir que toute personne utilisant le DM IA comprend son fonctionnement, ses limites et ses risques.", ref:"R√®glement (UE) 2024/1689 art. 4 ¬ß1", statut:"", resp:"", comm:"Plan de formation utilisateur", critChecks:[true,true,true,false] },
  { n:"C.11", act:"Concevoir la robustesse et la fiabilit√© per√ßue par l'utilisateur.", obj:"S'assurer que le syst√®me r√©agit de mani√®re stable, compr√©hensible et pr√©visible.", ref:"R√®glement (UE) 2024/1689 art. 15 ¬ß1-3", statut:"", resp:"", comm:"√âvaluation de la fiabilit√© et de la perception", critChecks:[true,true,true,true] },
  { n:"C.12", act:"Fournir une notice d'utilisation claire, concise et adapt√©e.", obj:"Assurer que la documentation fournie est compr√©hensible, compl√®te et utilisable.", ref:"R√®glement (UE) 2024/1689 art. 13 ¬ß2 & ¬ß3 b (i-iii)", statut:"", resp:"", comm:"√âvaluation des documents d'accompagnement", critChecks:[true,true,true,true] },
  { n:"C.13", act:"Informer sur la maintenance, les mises √† jour et la dur√©e de vie.", obj:"Garantir que l'utilisateur sache comment maintenir la performance et la s√©curit√©.", ref:"R√®glement (UE) 2024/1689 art. 13 ¬ß3 e", statut:"", resp:"", comm:"Plan de formation et maintenance du logiciel", critChecks:[true,true,true,false] },
  { n:"C.14", act:"Int√©grer les mesures de ma√Ætrise du risque dans les exigences logicielles.", obj:"Inclure les mesures de maitrise du risque du logiciel dans la conception.", ref:"IEC 62304 ¬ß5.2.3", statut:"", resp:"", comm:"Exigences logicielles incluant les mesures de ma√Ætrise", critChecks:[true,true,true,true] },

  { section: true, titre: "D ‚Äì SURVEILLANCE DU SYST√àME PAR LES UTILISATEURS" },
  { n:"D.1", act:"Conception de la supervision humaine (HITL/HOTL).", obj:"Garantir la possibilit√© d'intervenir et corriger.", ref:"R√®glement (UE) 2024/1689 art.14", statut:"", resp:"", comm:"Plan de surveillance post-commercialisation", critChecks:[true,true,true,true] },
  { n:"D.2", act:"Identifier les caract√©ristiques de l'interface utilisateur li√©es √† la s√©curit√© et les erreurs d'utilisation possibles via l'analyse des t√¢ches.", obj:"Identifier les facteurs de risque li√©s √† l'interface afin de pr√©venir les usages incorrects.", ref:"IEC 62366-1 ¬ß5.2", statut:"", resp:"", comm:"Analyse des t√¢ches et facteurs de risque UI", critChecks:[true,true,true,false] },
  { n:"D.3", act:"Identifier les ph√©nom√®nes dangereux et situations dangereuses connus ou pr√©visibles li√©s √† l'utilisation du dispositif m√©dical.", obj:"Reconna√Ætre les dangers potentiels d√®s la conception.", ref:"IEC 62366-1 ¬ß5.3", statut:"", resp:"", comm:"Analyse des ph√©nom√®nes et situations dangereuses", critChecks:[true,true,false,false] },
  { n:"D.4", act:"Interdire toute fonctionnalit√© d'influence subliminale ou manipulatrice.", obj:"Garantir la s√©curit√© psychologique et la prise de d√©cision √©clair√©e des utilisateurs.", ref:"R√®glement (UE) 2024/1689 art. 5(1)(a)", statut:"", resp:"", comm:"Documents expliquant l'absence de techniques manipulatrices", critChecks:[true,true,false,false] },
  { n:"D.5", act:"√âviter toute inf√©rence √©motionnelle ou biom√©trique non m√©dicale.", obj:"Garantir la finalit√© m√©dicale et limiter l'usage des donn√©es biom√©triques.", ref:"R√®glement (UE) 2024/1689 art. 5(1)(f)-(g)", statut:"", resp:"", comm:"Dossier de conception (choix sur les donn√©es biom√©triques)", critChecks:[true,true,false,false] },
  { n:"D.6", act:"D√©montrer la ma√Ætrise humaine du syst√®me.", obj:"S'assurer que l'humain conserve la capacit√© de contr√¥ler, interrompre ou corriger le syst√®me.", ref:"R√®glement (UE) 2024/1689 art. 4 ¬ß1 & 14 ¬ß1-3", statut:"", resp:"", comm:"Dossier de conception (m√©canismes de contr√¥le humain)", critChecks:[true,true,true,true] },
  { n:"D.7", act:"Fournir une transparence suffisante pour interpr√©ter les sorties.", obj:"Concevoir le syst√®me de sorte que les r√©sultats puissent √™tre compris et expliqu√©s.", ref:"R√®glement (UE) 2024/1689 art. 13 ¬ß1 & ¬ß3 b (iv, vii)", statut:"", resp:"", comm:"Documentation de la logique de d√©cision, √©crans explicatifs", critChecks:[true,true,true,true] },
  { n:"D.8", act:"Pr√©voir des m√©canismes d'alerte et de retour utilisateur.", obj:"Permettre de signaler un dysfonctionnement, une incertitude ou un doute sur la sortie.", ref:"R√®glement (UE) 2024/1689 art. 14 ¬ß2-3", statut:"", resp:"", comm:"Fonctions de feedback, boutons de signalement, journaux", critChecks:[true,true,true,true] },
  { n:"D.9", act:"Garantir la tra√ßabilit√© des interactions homme-IA.", obj:"Enregistrer automatiquement les √©v√©nements d'utilisation pertinents.", ref:"R√®glement (UE) 2024/1689 art. 12 ¬ß1-3 a-d", statut:"", resp:"", comm:"Logs et journaux d'interactions", critChecks:[true,true,true,false] },
  { n:"D.10", act:"Expliquer la logique du mod√®le ou les crit√®res de d√©cision.", obj:"Permettre √† l'utilisateur de comprendre pourquoi une sortie ou recommandation a √©t√© produite.", ref:"R√®glement (UE) 2024/1689 art. 13 ¬ß1", statut:"", resp:"", comm:"Documentation expliquant la logique du mod√®le", critChecks:[true,true,true,true] },

  { section: true, titre: "E ‚Äì AM√âLIORATION CONTINUE" },
  { n:"E.1", act:"Plan de PMS IA et de d√©tection de d√©rive (pr√©vu d√®s la conception).", obj:"Faciliter le suivi post-march√© et l'am√©lioration continue.", ref:"R√®glement (UE) 2024/1689 art.72 (PMS), art.73 (incidents)", statut:"", resp:"", comm:"Plan de surveillance post-commercialisation", critChecks:[true,true,true,false] },
  { n:"E.2", act:"Identifier et combler les lacunes dans les donn√©es via un processus de d√©tection des donn√©es manquantes ou insuffisantes et d√©crire comment elles sont compl√©t√©es.", obj:"√âviter les d√©faillances fonctionnelles dues √† un jeu de donn√©es incomplet.", ref:"R√®glement (UE) 2024/1689 art. 10 ¬ß2(h)", statut:"", resp:"", comm:"Proc√©dure de d√©tection et compl√©tude des donn√©es", critChecks:[true,true,false,false] }
];

// -------- 2. Fonctions d‚Äôinterface --------
function startApp() {
  const nom = document.getElementById('nom').value.trim();
  const prenom = document.getElementById('prenom').value.trim();
  if (!nom || !prenom) {
    alert("Merci de saisir nom et pr√©nom.");
    return;
  }
  document.getElementById('connexion').classList.add('hide');
  document.getElementById('app').classList.remove('hide');

  // On commence sur l‚Äôonglet checklist, classification g√©r√©e par showTab
  showTab('checklist');
  renderChecklist();
}

function showTab(tab) {
  // masquer les sections de contenu
  document.getElementById('guide').classList.add('hide');
  document.getElementById('checklist').classList.add('hide');
  document.getElementById('faq').classList.add('hide');

  // g√©rer la div classification : visible uniquement sur checklist
  const classification = document.getElementById('classification');
  if (tab === 'checklist') {
    classification.classList.remove('hide');
  } else {
    classification.classList.add('hide');
  }

  // afficher la section choisie
  document.getElementById(tab).classList.remove('hide');

  // g√©rer les boutons d‚Äôonglet
  let tbs = document.querySelectorAll('.tab-btn');
  for (let i=0; i<tbs.length; i++) tbs[i].classList.remove('selected');
  if(tab==='guide') tbs[0].classList.add('selected');
  if(tab==='checklist') tbs[1].classList.add('selected');
}

// -------- 3. Calcul du score --------
function computeGlobalCoef() {
  const classe = parseFloat(document.getElementById('classeMdr').value || "1");
  const seku = parseFloat(document.getElementById('iaSecu').value || "1");
  const role = parseFloat(document.getElementById('roleAuto').value || "1");
  return classe * seku * role; // plus de niveau AI Act
}

function applyClassification() {
  const coef = computeGlobalCoef();
  document.getElementById('coefGlobalDisplay').textContent =
    "Score de classification : " + coef.toFixed(2);

  checklist.forEach(item => {
    if (item.section) return;
    const checks = item.critChecks || [];
    const sumCrit = checks.reduce((acc, c) => acc + (c ? 1 : 0), 0);
    item.score = sumCrit * coef;
  });

  renderChecklist();
}

function getScoreColor(score) {
  if (isNaN(score)) return '';
  if (score < 7) return '#5cb85c';        // VERT (0 √† <7)
  if (score >= 7 && score < 14) return '#f0ad4e';  // ORANGE (7 √† <14)
  return '#d9534f';                        // ROUGE (>=14)
}



// -------- 4. Affichage de la checklist --------
function renderChecklist() {
  const tbody = document.getElementById('tbodyChecklist');
  tbody.innerHTML = '';

  checklist.forEach((item, idx) => {
    if (item.section) {
      const trSec = document.createElement('tr');
      trSec.className = 'section-row';
      const tdSec = document.createElement('td');
      tdSec.colSpan = 9;
      tdSec.textContent = item.titre;
      trSec.appendChild(tdSec);
      tbody.appendChild(trSec);
      return;
    }

    const tr = document.createElement('tr');

    let td = document.createElement('td');
    td.textContent = item.n;
    tr.appendChild(td);

    td = document.createElement('td');
    td.textContent = item.act;
    tr.appendChild(td);

    td = document.createElement('td');
    td.style.verticalAlign = "top";
    td.style.padding = "4px";

    const critLabels = [
      "Impact sur la s√©curit√© d'usage / risque d'erreur humaine",
      "Impact sur la compr√©hension / interpr√©tation de l'IA",
      "Impact sur la supervision humaine",
      "Impact sur la conformit√© r√©glementaire (IA Act / MDR)"
    ];
    const checks = item.critChecks || [false,false,false,false];

    critLabels.forEach((label, i) => {
      const row = document.createElement('div');
      row.style.display = "flex";
      row.style.alignItems = "center";
      row.style.marginBottom = "2px";

      const svgEmpty = '<svg width="14" height="14" viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"><rect x="1" y="1" width="12" height="12" fill="white" stroke="#555" stroke-width="1.2"/></svg>';
      const svgFull = '<svg width="14" height="14" viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"><rect x="1" y="1" width="12" height="12" fill="#04284b" stroke="#04284b" stroke-width="1.2"/><polyline points="3,8 6,11 11,4" fill="none" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>';

      const icon = document.createElement('span');
      icon.innerHTML = checks[i] ? svgFull : svgEmpty;
      icon.style.display = "inline-block";
      icon.style.marginRight = "4px";

      const span = document.createElement('span');
      span.textContent = " " + label;
      span.style.fontSize = "0.72em";

      row.appendChild(icon);
      row.appendChild(span);
      td.appendChild(row);
    });
    tr.appendChild(td);

    // Score calcul√©
    td = document.createElement('td');
    td.style.textAlign = "center";
    td.style.fontWeight = "bold";

    if (item.score !== undefined) {
    const scoreVal = item.score;
    td.textContent = scoreVal.toFixed(1);
    const color = getScoreColor(scoreVal);
    if (color) {
        td.style.backgroundColor = color;
        td.style.color = "#ffffff";
    }
    } else {
    td.textContent = "";
    }

    tr.appendChild(td);

    td = document.createElement('td');
    td.textContent = item.obj;
    tr.appendChild(td);

    td = document.createElement('td');
    td.textContent = item.ref;
    tr.appendChild(td);

    td = document.createElement('td');
    const select = document.createElement('select');
    ["", "√Ä faire", "En cours", "Termin√©"].forEach(opt => {
      const o = document.createElement('option');
      o.value = opt;
      o.text = opt;
      if (item.statut === opt) o.selected = true;
      select.appendChild(o);
    });
    select.onchange = function(){ checklist[idx].statut = this.value; };
    td.appendChild(select);
    tr.appendChild(td);

    td = document.createElement('td');
    const inresp = document.createElement('input');
    inresp.type = 'text';
    inresp.value = item.resp || "";
    inresp.oninput = function(){ checklist[idx].resp = this.value; };
    td.appendChild(inresp);
    tr.appendChild(td);

    td = document.createElement('td');
    td.style.fontSize = "0.8em";
    td.style.color = "#555";
    td.style.backgroundColor = "#f5f5f5";
    td.style.whiteSpace = "normal";
    td.style.maxWidth = "260px";

    const hint = document.createElement('div');
    hint.textContent = item.comm;
    hint.style.marginBottom = "4px";

    const fileInput = document.createElement('input');
    fileInput.type = "file";
    fileInput.style.fontSize = "0.75em";

    td.appendChild(hint);
    td.appendChild(fileInput);
    tr.appendChild(td);

    tbody.appendChild(tr);
  });
}

// -------- 5. PDF --------
function generatePDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF('l', 'mm', 'a4');

  // Titre
  doc.setFontSize(16);
  doc.setFont(undefined, 'bold');
  doc.text("Checklist R√©glementaire - Validation de l'Aptitude √† l'Utilisation", 14, 15);

  // Infos utilisateur
  const nom = document.getElementById('nom').value || '‚Äî';
  const prenom = document.getElementById('prenom').value || '‚Äî';
  const societe = document.getElementById('societe').value || '‚Äî';
  const profession = document.getElementById('profession').value || '‚Äî';

  doc.setFontSize(10);
  doc.setFont(undefined, 'normal');
  doc.text(`Nom: ${nom} | Pr√©nom: ${prenom} | Soci√©t√©: ${societe} | Profession: ${profession}`, 14, 22);

  // ---- Bloc classification dans le PDF ----
  const classeMdr = document.getElementById('classeMdr')?.value || '‚Äî';
  const iaSecu = document.getElementById('iaSecu')?.value || '‚Äî';
  const roleAuto = document.getElementById('roleAuto')?.value || '‚Äî';


  let coefText = '‚Äî';
  try {
    const coef = computeGlobalCoef();
    if (!isNaN(coef)) coefText = coef.toFixed(2);
  } catch(e) {
    coefText = '‚Äî';
  }

  doc.setFontSize(9);
  doc.setFont(undefined, 'bold');
  doc.text("Classification du dispositif :", 14, 28);

  doc.setFont(undefined, 'normal');
  doc.text(`Classe MDR: ${classeMdr} | IA composante de s√©curit√©: ${iaSecu} | R√¥le autonome: ${roleAuto}`, 14, 33);
  doc.text(`Score de classification global: ${coefText}`, 14, 38);

  // D√©caler le d√©but du tableau apr√®s le bloc classification
  const headers = ['N¬∞', 'Exigence/Action', 'Score', 'Objectif', 'R√©f√©rence', 'Statut', 'Responsable', 'Commentaires'];
  const tableData = [];

  checklist.forEach(item => {
    if (item.section) {
      tableData.push([{
        content: item.titre,
        colSpan: headers.length,
        styles: { fillColor: [223, 238, 255], fontStyle: 'bold', halign: 'center' }
      }]);
    } else {
      const critChecked = (item.critChecks || []).filter(c => c).length;
      const critStr = `${critChecked}/4`;

      tableData.push([
        item.n,
        item.act,
        item.score !== undefined ? item.score.toFixed(1) : '',
        item.obj,
        item.ref,
        item.statut || '‚Äî',
        item.resp || '‚Äî',
        `${critStr} ¬∑ ${item.comm}`
      ]);
    }
  });

  doc.autoTable({
    head: [headers],
    body: tableData,
    startY: 44,
    margin: 10,
    styles: { fontSize: 8, cellPadding: 2, overflow: 'linebreak', halign: 'left' },
    headStyles: { fillColor: [130,184,234], textColor: [0,0,0], fontStyle: 'bold' },
    alternateRowStyles: { fillColor: [245,245,245] },
    didParseCell: function (data) {
        // Coloration de la colonne Score (index 2) dans le body
        if (data.section === 'body' && data.column.index === 2) {
        const raw = data.cell.raw;
        const score = parseFloat(raw);
        if (!isNaN(score)) {
            let fill = null;
            if (score >= 0 && score < 7) {
            fill = [92, 184, 92];      // Vert
            } else if (score >= 7 && score < 14) {
            fill = [240, 173, 78];     // Orange
            } else if (score >= 14 && score < 36) {
            fill = [217, 83, 79];      // Rouge
            }
            if (fill) {
            data.cell.styles.fillColor = fill;
            data.cell.styles.textColor = [255, 255, 255];
            }
        }
        }
    }
    });


  const timestamp = new Date().toISOString().split('T')[0];
  doc.save(`Checklist-${prenom}-${nom}-${timestamp}.pdf`);
}
</script>
</body>
</html>
